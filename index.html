<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a237e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Graha Role Mapping Sheet</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            font-size: 14px;
            background-color: #ffffff;
            color: #333;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
        }

        .header h1 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .nav-buttons {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .main-content {
            padding: 12px;
            max-width: 100%;
        }

        /* Rashi Chart - Compact for mobile */
        .chart-section {
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1a237e;
            margin-bottom: 8px;
            padding-left: 4px;
        }

        .rashi-chart {
            width: 100%;
            max-width: 320px;
            aspect-ratio: 1;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 1px;
            padding: 1px;
            background-color: #1a237e;
            border-radius: 8px;
            overflow: hidden;
        }

        .rashi-box {
            background-color: white;
            padding: 4px;
            position: relative;
            min-height: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
        }

        .rashi-number {
            display: none;
        }

        .planet-names {
            font-size: 0.7rem;
            text-align: center;
            color: #1a237e;
            word-wrap: break-word;
            line-height: 1.2;
            font-weight: 500;
        }

        .chart-title {
            grid-column: 2 / 4;
            grid-row: 2 / 4;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            color: white;
            background-color: #1a237e;
            border-radius: 4px;
        }

        /* Table Styles - Card view for mobile */
        .table-section {
            margin-top: 16px;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
            min-width: 600px;
        }

        th {
            background-color: #1a237e;
            color: white;
            font-weight: 600;
            padding: 10px 6px;
            text-align: center;
            text-transform: uppercase;
            font-size: 0.65rem;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:active {
            background-color: #e8eaf6;
        }

        /* Select dropdown styling */
        select {
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 0.7rem;
            width: 100%;
            max-width: 90px;
            background-color: white;
            color: #333;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 6px center;
            padding-right: 20px;
        }

        select:focus {
            outline: none;
            border-color: #1a237e;
        }

        /* Read Button - Floating */
        .fab-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            border: none;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .fab-button:active {
            transform: scale(0.95);
        }

        /* Context Window */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 1999;
            backdrop-filter: blur(2px);
        }

        .context-window {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 92%;
            max-width: 400px;
            max-height: 80vh;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 2000;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .context-header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 16px;
        }

        .context-header h2 {
            margin: 0;
            font-size: 1.1rem;
        }

        .context-body {
            padding: 16px;
            overflow-y: auto;
            flex: 1;
        }

        .planet-info {
            margin-bottom: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #1a237e;
        }

        .planet-info h3 {
            margin: 0 0 6px 0;
            font-size: 0.9rem;
            color: #1a237e;
        }

        .planet-info p {
            margin: 0;
            font-size: 0.8rem;
            color: #555;
            line-height: 1.5;
        }

        .context-footer {
            padding: 12px 16px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .context-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .context-btn:active {
            opacity: 0.8;
        }

        .btn-primary {
            background: #1a237e;
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        /* Tablet and larger screens */
        @media screen and (min-width: 768px) {
            .main-content {
                padding: 20px;
                max-width: 1200px;
                margin: 0 auto;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .rashi-chart {
                max-width: 400px;
            }

            .rashi-box {
                padding: 8px;
                font-size: 0.85rem;
            }

            .planet-names {
                font-size: 0.85rem;
            }

            .chart-title {
                font-size: 1rem;
            }

            table {
                font-size: 0.85rem;
                min-width: auto;
            }

            th {
                padding: 12px 8px;
                font-size: 0.75rem;
            }

            td {
                padding: 10px 8px;
            }

            select {
                font-size: 0.8rem;
                max-width: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>Graha Role Mapping</h1>
            <div class="nav-buttons">
                <a href="https://vaiswanara.com" class="nav-btn">Home</a>
                <a href="Prediction.html" class="nav-btn">Analyze</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Rashi Chart -->
        <section class="chart-section">
            <div class="section-title">Rashi Chakra</div>
            <div class="rashi-chart">
                <div class="rashi-box"><span class="rashi-number">12</span><div class="planet-names" id="box12"></div></div>
                <div class="rashi-box"><span class="rashi-number">1</span><div class="planet-names" id="box1"></div></div>
                <div class="rashi-box"><span class="rashi-number">2</span><div class="planet-names" id="box2"></div></div>
                <div class="rashi-box"><span class="rashi-number">3</span><div class="planet-names" id="box3"></div></div>
                <div class="rashi-box"><span class="rashi-number">11</span><div class="planet-names" id="box11"></div></div>
                <div class="chart-title">Rashi<br>Chakra</div>
                <div class="rashi-box"><span class="rashi-number">4</span><div class="planet-names" id="box4"></div></div>
                <div class="rashi-box"><span class="rashi-number">10</span><div class="planet-names" id="box10"></div></div>
                <div class="rashi-box"><span class="rashi-number">5</span><div class="planet-names" id="box5"></div></div>
                <div class="rashi-box"><span class="rashi-number">9</span><div class="planet-names" id="box9"></div></div>
                <div class="rashi-box"><span class="rashi-number">8</span><div class="planet-names" id="box8"></div></div>
                <div class="rashi-box"><span class="rashi-number">7</span><div class="planet-names" id="box7"></div></div>
                <div class="rashi-box"><span class="rashi-number">6</span><div class="planet-names" id="box6"></div></div>
            </div>
        </section>

        <!-- Table -->
        <section class="table-section">
            <div class="section-title">Planet Details</div>
            <div class="table-container">
                <table id="planetTable">
                    <tr>
                        <th>GRAHA</th>
                        <th>Rashi</th>
                        <th>ADHIPATHYA</th>
                        <th style="display: none;">Rashi Number</th>
                        <th>STHAANA</th>
                        <th>SAMYOGA</th>
                        <th>DRUSTI</th>
                    </tr>
                </table>
            </div>
        </section>
    </main>

    <!-- Floating Action Button -->
    <button class="fab-button" onclick="showContextWindow()">Read</button>

    <!-- Context Window -->
    <div class="overlay" id="overlay" onclick="hideContextWindow()"></div>
    <div class="context-window" id="contextWindow" style="display: none;">
        <div class="context-header">
            <h2>Planet Details</h2>
        </div>
        <div class="context-body" id="planetDetails"></div>
        <div class="context-footer">
            <button class="context-btn btn-secondary" onclick="hideContextWindow()">Close</button>
            <button class="context-btn btn-primary" onclick="downloadPlanetDetails()">Print</button>
        </div>
    </div>

    <script>
        const planets = ['Lagna', 'Su', 'Ch', 'Ku', 'Bu', 'Gu', 'Sk', 'Sa', 'Ra', 'Ke'];
        const rashis = ['Mesha', 'Vrushabha', 'Mithuna', 'Karka', 'Simha', 'Kanya', 'Tula', 'Vrushchika', 'Dhanu', 'Makara', 'Kumbha', 'Meena'];
        
        const lordshipData = {
            "1": { "Su": "5", "Ch": "4", "Ku": "1,8", "Bu": "3,6", "Gu": "9,12", "Sk": "2,7", "Sa": "10,11" },
            "2": { "Su": "4", "Ch": "3", "Ku": "7,12", "Bu": "2,5", "Gu": "8,11", "Sk": "1,6", "Sa": "9,10" },
            "3": { "Su": "3", "Ch": "2", "Ku": "6,11", "Bu": "1,4", "Gu": "7,10", "Sk": "5,12", "Sa": "8,9" },
            "4": { "Su": "2", "Ch": "1", "Ku": "5,10", "Bu": "3,12", "Gu": "6,9", "Sk": "4,11", "Sa": "7,8" },
            "5": { "Su": "1", "Ch": "12", "Ku": "4,9", "Bu": "2,11", "Gu": "5,8", "Sk": "3,10", "Sa": "6,7" },
            "6": { "Su": "12", "Ch": "11", "Ku": "3,8", "Bu": "1,10", "Gu": "4,7", "Sk": "2,9", "Sa": "5,6" },
            "7": { "Su": "11", "Ch": "10", "Ku": "2,7", "Bu": "9,12", "Gu": "3,6", "Sk": "1,8", "Sa": "4,5" },
            "8": { "Su": "10", "Ch": "9", "Ku": "1,6", "Bu": "8,11", "Gu": "2,5", "Sk": "7,12", "Sa": "3,4" },
            "9": { "Su": "9", "Ch": "8", "Ku": "5,12", "Bu": "7,10", "Gu": "1,4", "Sk": "6,11", "Sa": "2,3" },
            "10": { "Su": "8", "Ch": "7", "Ku": "4,11", "Bu": "6,9", "Gu": "3,12", "Sk": "5,10", "Sa": "1,2" },
            "11": { "Su": "7", "Ch": "6", "Ku": "3,10", "Bu": "5,8", "Gu": "2,11", "Sk": "4,9", "Sa": "12,1" },
            "12": { "Su": "6", "Ch": "5", "Ku": "2,9", "Bu": "4,7", "Gu": "1,10", "Sk": "3,8", "Sa": "11,12" }
        };

        function getLordship(planetName, lagnaRashi) {
            if (!lagnaRashi || planetName === 'Lagna' || planetName === 'Ra' || planetName === 'Ke') return '';
            return lordshipData[lagnaRashi][planetName] || '';
        }

        const table = document.getElementById('planetTable');
        
        function calculateHouseNumber(planetRashiNumber, lagnaRashiNumber) {
            if (!planetRashiNumber || !lagnaRashiNumber) return '';
            if (planetRashiNumber === lagnaRashiNumber) return '1';
            
            let houseNumber = parseInt(planetRashiNumber) - parseInt(lagnaRashiNumber) + 1;
            if (houseNumber <= 0) houseNumber += 12;
            return houseNumber.toString();
        }

        function findConjunctions(planetIndex, rashiNumber, allSelects) {
            let conjunctions = [];
            allSelects.forEach((select, index) => {
                if (index !== planetIndex && select.value === rashiNumber && rashiNumber !== '' && planets[index] !== 'Lagna') {
                    conjunctions.push(planets[index]);
                }
            });
            return conjunctions.join(', ');
        }

        function updateChart() {
            for(let i = 1; i <= 12; i++) {
                document.getElementById(`box${i}`).textContent = '';
            }
            
            const selects = document.querySelectorAll('select');
            const lagnaRashiNumber = selects[0].value;
            
            selects.forEach((select, index) => {
                const rashiNumber = select.value;
                if(rashiNumber) {
                    const planetName = planets[index];
                    const box = document.getElementById(`box${rashiNumber}`);
                    box.textContent = box.textContent ? box.textContent + ', ' + planetName : planetName;
                    
                    const houseCell = select.parentNode.parentNode.cells[4];
                    houseCell.textContent = index === 0 ? '1' : calculateHouseNumber(rashiNumber, lagnaRashiNumber);
                    
                    const lordshipCell = select.parentNode.parentNode.cells[2];
                    lordshipCell.textContent = getLordship(planetName, lagnaRashiNumber);
                    
                    const conjunctionCell = select.parentNode.parentNode.cells[5];
                    conjunctionCell.textContent = findConjunctions(index, rashiNumber, selects);
                    
                    const aspectCell = select.parentNode.parentNode.cells[6];
                    aspectCell.textContent = findAspects(index, rashiNumber, selects);
                }
            });
        }
        
        function calculateAspects(targetRashi, aspectingPlanet, aspectingRashi) {
            if (!targetRashi || !aspectingRashi) return false;
            
            const source = parseInt(aspectingRashi);
            const target = parseInt(targetRashi);
            
            const aspectingPlanetName = planets[aspectingPlanet];
            let aspects = [];
            
            if (aspectingPlanetName !== 'Lagna') {
                let seventhHouse = source + 6;
                if (seventhHouse > 12) seventhHouse -= 12;
                if (target === seventhHouse) aspects.push("7th");
            }
            
            if (aspectingPlanetName === 'Gu') {
                let fifthHouse = source + 4;
                let ninthHouse = source + 8;
                
                if (fifthHouse > 12) fifthHouse -= 12;
                if (ninthHouse > 12) ninthHouse -= 12;
                
                if (target === fifthHouse) aspects.push("5th");
                if (target === ninthHouse) aspects.push("9th");
            }
            else if (aspectingPlanetName === 'Sa') {
                let thirdHouse = source + 2;
                let tenthHouse = source + 9;
                
                if (thirdHouse > 12) thirdHouse -= 12;
                if (tenthHouse > 12) tenthHouse -= 12;
                
                if (target === thirdHouse) aspects.push("3rd");
                if (target === tenthHouse) aspects.push("10th");
            }
            else if (aspectingPlanetName === 'Ku') {
                let fourthHouse = source + 3;
                let eighthHouse = source + 7;
                
                if (fourthHouse > 12) fourthHouse -= 12;
                if (eighthHouse > 12) eighthHouse -= 12;
                
                if (target === fourthHouse) aspects.push("4th");
                if (target === eighthHouse) aspects.push("8th");
            }
            
            return aspects.length > 0 ? aspects.join(",") : false;
        }

        function findAspects(planetIndex, rashiNumber, allSelects) {
            let aspects = [];
            allSelects.forEach((select, index) => {
                if (index !== planetIndex && select.value !== '') {
                    const aspectType = calculateAspects(rashiNumber, index, select.value);
                    if (aspectType && planets[index] !== 'Lagna') {
                        aspects.push(`${planets[index]}`);
                    }
                }
            });
            return aspects.join(', ');
        }

        planets.forEach(planet => {
            const row = table.insertRow();
            
            const planetCell = row.insertCell();
            planetCell.textContent = planet;
            
            const rashiCell = row.insertCell();
            const select = document.createElement('select');
            select.innerHTML = '<option value="">Select</option>' + 
                rashis.map((rashi, index) => `<option value="${index + 1}">${rashi}</option>`).join('');
            
            const lordshipCell = row.insertCell();
            
            const numberCell = row.insertCell();
            numberCell.style.display = 'none';
            
            const houseCell = row.insertCell();
            
            const conjunctionCell = row.insertCell();
            
            const aspectCell = row.insertCell();
            
            select.addEventListener('change', (e) => {
                numberCell.textContent = e.target.value;
                updateChart();
            });
            
            rashiCell.appendChild(select);
        });

        function showContextWindow() {
            const contextWindow = document.getElementById('contextWindow');
            const overlay = document.getElementById('overlay');
            const planetDetails = document.getElementById('planetDetails');
            planetDetails.innerHTML = '';
        
            const selects = document.querySelectorAll('select');
            
            planets.forEach((planet, index) => {
                const select = selects[index];
                const row = select.parentNode.parentNode;
                const rashiValue = select.value ? rashis[parseInt(select.value) - 1] : '';
                const adhipathya = row.cells[2].textContent;
                const sthaana = row.cells[4].textContent;
                const samyoga = row.cells[5].textContent;
                const drusti = row.cells[6].textContent;
        
                if ((rashiValue || adhipathya || sthaana || samyoga || drusti) && planet !== 'Lagna') {
                    const planetInfo = document.createElement('div');
                    planetInfo.className = 'planet-info';
                    
                    let infoText = `<h3>${planet}</h3><p>`;
                    
                    if (adhipathya) {
                        infoText += `${adhipathya} Lord ${planet}`;
                    } else {
                        infoText += planet;
                    }
                    
                    if (sthaana) {
                        infoText += ` posited in ${sthaana} House`;
                    }
                    
                    if (samyoga) {
                        infoText += `. Samyoga with ${samyoga}`;
                    }
                    
                    if (drusti) {
                        infoText += `. Aspected by ${drusti}`;
                    }
                    
                    infoText += '.</p>';
                    planetInfo.innerHTML = infoText;
                    planetDetails.appendChild(planetInfo);
                }
            });
        
            contextWindow.style.display = 'flex';
            overlay.style.display = 'block';
        }

        function hideContextWindow() {
            document.getElementById('contextWindow').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        function downloadPlanetDetails() {
            const planetDetails = document.getElementById('planetDetails');
            let textContent = 'Planet Details Report\n\n';
            
            const planetInfos = planetDetails.getElementsByClassName('planet-info');
            Array.from(planetInfos).forEach(planetInfo => {
                const text = planetInfo.textContent.trim()
                    .replace(/\n+/g, '\n')
                    .replace(/\s+/g, ' ')
                    .trim();
                textContent += text + '\n\n';
            });

            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'planet_details.txt';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
